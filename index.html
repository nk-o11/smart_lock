<!DOCTYPE html>
<html>
<body>
<h2>Smart Lock Control</h2>

<p>ç¾åœ¨ã®çŠ¶æ…‹: <span id="currentState">èª­ã¿è¾¼ã¿ä¸­...</span></p>
<button onclick="fetchState()">ğŸ”„ çŠ¶æ…‹ã‚’æ›´æ–°</button>
<br><br>

<button onclick="updateState('locked')">ğŸ”’ Lock</button>
<button onclick="updateState('unlocked')">ğŸ”“ Unlock</button>

<script>
const url = "https://wsihshdjwsukyevqotpd.supabase.co/rest/v1/lock_state?id=eq.1&select=state";
const apikey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzaWhzaGRqd3N1a3lldnFvdHBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NTg0NjYsImV4cCI6MjA4NTIzNDQ2Nn0.osEUkiebySs0MXi2lYYF8gSnZpjpWTFMfMawKq6o62U";

// ç¾åœ¨ã®çŠ¶æ…‹ã‚’å–å¾—ã—ã¦è¡¨ç¤º
async function fetchState() {
    const res = await fetch(url, {
        headers: { "apikey": apikey }
    });
    const data = await res.json();
    document.getElementById("currentState").textContent = data[0].state;
}

// çŠ¶æ…‹ã‚’å¤‰æ›´
async function updateState(state) {
    const updateUrl = "https://wsihshdjwsukyevqotpd.supabase.co/rest/v1/lock_state?id=eq.1";

    await fetch(updateUrl, {
        method: "PATCH",
        headers: {
            "apikey": apikey,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ state: state })
    });

    alert("State updated: " + state);
    fetchState(); // æ›´æ–°å¾Œã«æœ€æ–°çŠ¶æ…‹ã‚’è¡¨ç¤º
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«çŠ¶æ…‹ã‚’å–å¾—
fetchState();
</script>
</body>
</html>
